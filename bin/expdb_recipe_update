#!/bin/env python

def update():

	"""
	Created on Fri Jun 02 17:27:44 2017
	@author: Ian
	"""
	# Automatically updates and uploads packages to the cloud
	import os, sys, subprocess 
	# Search for the package
	search = subprocess.check_output(['conda', 'search', 'gladio'])

	# Take version number from package
	#v = [int(s) for s in search.split() if s.isdigit()]

	print(search)

	v = search.split(".")

	lastLine = v[len(v)-1]

	print("lastLine is: " +lastLine + "\n")

	oldVersionNumber = int(lastLine.split()[0]) 

	newVer = oldVersionNumber + 1

	print("Old version is: " + str(oldVersionNumber) + "\nNew version number is: " + newVer + "\n")

	f = open("/reg/g/psdm/sw/conda/manage/recipes/psana/psana-expdb/meta.yaml","r")

	oldMeta = f.read()

	splitUp = oldMeta.split(".",1)

	newMeta = splitUp[0] + "." + str(newVer)+"\""+splitUp[1].split("\"",1)[1]

	j = open('/reg/g/psdm/sw/conda/manage/recipes/psana/psana-expdb/meta.yaml', 'w')
	j.write(newMeta)
	j.close

	print("psana-expdb-0." + str(newVer) + "-1.tar.bz2")

update()
